<!-- Filename: index.html-->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Letra ‚Äî Jogo de palavras offline</title>
  <style>
    /* Light mode color variables */
    :root {
      --color-bg: #f9f9f9;           /* Main background */
      --color-text: #222222;         /* Default text color */
      --color-subtle: #888888;       /* Secondary text color */
      --color-border: #cccccc;       /* Borders and light lines */
      --color-tile: #e0e0e0;         /* Tile background (game squares) */

      --color-accent: #3ecf8e;       /* Accent color */
      --color-correct: #6aaa64;      /* Correct letter tile color */
      --color-wrong-spot: #c9b458;   /* Letter in wrong position tile color */
      --color-incorrect: #787c7e;    /* Incorrect letter tile color */
    }

    /* Dark mode colors override */
    body.dark {
      --color-bg: #121212;
      --color-text: #f1f1f1;
      --color-subtle: #aaaaaa;
      --color-border: #333333;
      --color-tile: #1e1e1e;
    }

    /* Reset default spacing and use border-box sizing */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    /* Base font size and smooth scrolling */
    html {
      font-size: 62.5%; /* 1rem = 10px */
      scroll-behavior: smooth;
    }

    /* Body layout and theming */
    body {
      display: flex;
      flex-direction: column;
      background-color: var(--color-bg);
      color: var(--color-text);
      font-family: sans-serif;
      font-size: 1.6rem; /* 16px */
      line-height: 1.5;
      transition: background-color 0.3s ease, color 0.3s ease;
      -webkit-font-smoothing: antialiased;
      min-height: 100vh;
      width: 100%;
    }

    /* Headings inherit font weight and color */
    h1, h2, h3, h4, h5, h6 {
      font-weight: 600;
      line-height: 1.2;
      color: inherit;
    }

    /* Links inherit color, no underline */
    a {
      color: inherit;
      text-decoration: none;
    }

    /* Remove default list styles */
    ul, ol {
      list-style: none;
    }

    /* Responsive media */
    img, picture, video, canvas, svg {
      max-width: 100%;
      display: block;
    }

    /* Form elements inherit font and remove borders */
    button, input, textarea, select {
      font: inherit;
      color: inherit;
      background: none;
      border: none;
      outline: none;
    }

    /* Remove number input spinner buttons on WebKit browsers */
    input[type="number"]::-webkit-inner-spin-button,
    input[type="number"]::-webkit-outer-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    /* Header grid layout */
    header {
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      align-items: center;
      padding: 1rem 3rem;
      gap: 1rem;
      background-color: var(--color-tile);
    }
    
    /* Left button group */
    .left-buttons {
      justify-self: start;
      display: flex;
      gap: 3rem;
    }

    /* Right button group */
    .right-buttons {
      justify-self: end;
      display: flex;
      gap: 3rem;
    }

    /* Center app name styling */
    .app-name {
      font-size: 2rem;
      justify-self: center;
      text-align: center;
    }

    /* Buttons in header larger for better tap targets */
    .left-buttons button,
    .right-buttons button {
      font-size: 4rem;
    }

    .left-buttons button:hover, 
    .right-buttons button:hover {
      cursor: pointer;
      transform: translateY(-5px);
      transition: 0.5s ease;
    }

    .modal {
      position: fixed;
      width: 100vw;
      height: 100vh;
      background: rgba(0,0,0,0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 999;
    }

    .modal-content {
      display: flex;
      flex-direction: column;
      align-items: center;
      background: rgba(62, 207, 142, 0.4);
      color: #f1f1f1;
      font-size: 3rem;
      padding: 6rem 2rem;
      border-radius: 8px;
      width: 50%;
      height: 50%;
      min-height: 300px;
      min-width: 300px;
      max-width: 900px;
      max-height: 900px;
      aspect-ratio: 1 / 1; /* Square form modal */
      overflow: auto;
    }

    .hidden {
      display: none;
    }

    .modal-content button {
      position: fixed;
      top: 8rem;
      left: 90%;
      font-size: 6rem;
      color: crimson;
      cursor: pointer;
      z-index: 100;
    }

    /* restart button */
    .restart-button {
      display: flex;
      align-items: center;
      justify-content: center;
      margin-top: 5rem;
    }

    #restart-button {
      font-size: 5rem;
    }

    #restart-button:hover {
      cursor: pointer;
      transform: translateY(-10px);
      transition: 0.5s ease;
    }

    /* Main board container styles */
    main {
      display: flex;
      align-items: center;
      justify-content: center;
      flex: 1; /* Take remaining vertical space */
    }
    
    /* Board holds rows vertically */
    .game-board {
      display: flex;
      flex-direction: column;
      max-width: 500px;
      width: 100%;
      gap: 1rem;
      margin-top: 2rem;
    }

    /* Each row is a grid of 5 tiles */
    .row {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 1rem;
    }

    /* Individual tile style */
    .tile {
      aspect-ratio: 1 / 1; /* Make tile square */
      background-color: var(--color-tile);
      border: 2px solid var(--color-border);
      border-radius: 1rem;
      font-size: 6rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: center;
      text-transform: uppercase;
      user-select: none; /* Prevent text selection */
      transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease;
    }

    /* Tile color for correct letter and position */
    .tile.correct {
      background-color: var(--color-correct);
      border-color: var(--color-correct);
      color: white;
    }

    /* Tile color for correct letter wrong position */
    .tile.present {
      background-color: var(--color-wrong-spot);
      border-color: var(--color-wrong-spot);
      color: white;
    }

    /* Tile color for incorrect letter */
    .tile.absent {
      background-color: var(--color-incorrect);
      border-color: var(--color-incorrect);
      color: white;
    }
    
    /* Virtual keyboard container */
    .virtual-keyboard {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.5rem;
      padding: 2rem 1rem;
      width: 100%;
      max-width: 700px;
      margin: 4rem auto;
      box-sizing: border-box;
    }

    /* Each keyboard row */
    .keyboard-row {
      display: flex;
      justify-content: center;
      gap: 0.4rem;
      width: 100%;
    }

    /* Individual key style */
    .key {
      background-color: var(--color-tile);
      color: white;
      font-size: clamp(1rem, 4vw, 2.5rem); /* Responsive font size */
      font-weight: bold;
      padding: 0.8em 0.6em;
      border: none;
      border-radius: 0.6rem;
      cursor: pointer;
      text-transform: uppercase;
      flex: 1;
      min-width: 2.5rem;
      transition: background-color 0.2s ease;
      box-sizing: border-box;
    }

    /* Hover effect for keys */
    .key:hover {
      background-color: var(--color-border);
    }

    /* Larger keys for Enter and Backspace */
    .key-large {
      flex: 1.5;
    }

    /* Color to the keys */
    .key.correct {
      background-color: #538d4e;
      color: white;
    }

    .key.present {
      background-color: #b59f3b;
      color: white;
    }

    .key.absent {
      background-color: #3a3a3c;
      color: white;
    }

    /* Footer styles */
    footer {
      text-align: center;
      padding: 1.5rem;
      background-color: var(--color-tile);
    }

    footer a {
      color: var(--color-accent);
      cursor: pointer;
    }
  </style>
</head>

<body class="dark">
  <!-- Website Header -->
  <header>
    <div class="left-buttons">
      <button type="button" id="help" aria-label="Help">‚ùî</button>
      <button type="button" id="stats" aria-label="Stats">üìä</button>
    </div>
    
    <div class="app-name">
      <h1>LETRA</h1>
    </div>

    <div class="right-buttons">
      <button type="button" id="theme" aria-label="Toggle between dark and light mode">üí°</button>
      <!-- About will display a dropdown menu with about, whoami, tactics and more -->
      <button type="button" id="cfg" aria-label="Configurations">‚öôÔ∏è</button>
    </div>
  </header>

  <!-- Modal container -->
  <div id="modal" class="modal hidden">
    <div class="modal-content" id="modal-content">
      <button onclick="closeModal()">üóô</button>
      <div id="modal-body">
        <!-- Dinamic content will be inserted here -->
      </div>
    </div>
  </div>


  <div class="restart-button">
    <button id="restart-button" style="display: none;" onclick="location.reload()">üîÑ</button>
  </div>


  <!-- Main board area with rows for each guess attempt -->
  <main>

    <div class="game-board">
      <!-- Tiles will be generated here dynamically with js -->
    </div>
  </main>
 

  <!-- On-screen keyboard for input, will be generated here with js-->
  <div class="virtual-keyboard data-status"></div>


  <footer>
    <small>Personal learning project, inspired by the term.ooo game ‚Äî Developed by <a href="https://www.github.com/xyz-leo" target="_blank">xyz-leo</a></small>
  </footer>


  <script>
    // Constants for board size
    const NUM_ROWS = 6;
    const NUM_COLS = 5;
    
    // Track if the game have been ended
    let gameOver = false;

    // Modal
    const modal = document.getElementById('modal');
    const modalContent = document.getElementById('modal-content');
    const modalBody = document.getElementById('modal-body');

    modal.addEventListener('click', (event) => {
      // Se o clique foi diretamente no fundo (modal), e n√£o dentro da caixinha (modal-content)
      if (event.target === modal) {
        closeModal();
      }
    });

    // --- Header buttons ---

    // Help button
    const helpbtn = document.getElementById('help');

    helpbtn.addEventListener('click', () => {
      openModal(`<h2>Ajuda</h2><p>Como jogar o jogo LETRA...</p>`);
    })

    // Stats button
    const statsbtn = document.getElementById('stats');

    statsbtn.addEventListener('click', () => {
      openModal(`<h2>Estat√≠sticas</h2><p>Jogos vencidos: 4<br>M√©dia: 4.5 tentativas</p>`);
    })

    // Theme dark/light mode change
    const togglebtn = document.getElementById('theme');
    const body = document.body;

    togglebtn.addEventListener('click', () => {
      body.classList.toggle("dark");
      body.classList.toggle("light");
    })
    
    // Configuration button
    const cfgbtn = document.getElementById('cfg');

    cfgbtn.addEventListener('click', () => {
      openModal(`<h2>Configura√ß√µes</h2><p><label>Tema autom√°tico <input type="checkbox"></label></p>`);
    })


    // words
    const words = {
      "easy": [
        "amigo", "andar", "baile", "banco", "bicho", "botas", "brisa", "cabra",
        "carta", "casal", "caixa", "carro", "certo", "chave", "cinza", "claro", "clima", "cofre",
        "coisa", "cores", "cesta", "cinto", "campo", "dente", "dizer", "doido", "d√≥lar", "feira",
        "feliz", "ferro", "festa", "filho", "fotos", "folha", "forno", "fruta", "gente", "gosto",
        "janela", "jogar", "leite", "letra", "lim√£o", "limpo", "linha", "livro", "lugar", "limpo",
        "mam√£e", "macio", "meias", "meiga", "metro", "moeda", "morar", "mundo", "navio",
        "noite", "norte", "nobre", "nuvem", "nadar", "olhos", "papai", "pacto", "pasta", "piano",
        "ponto", "pular", "passe", "peixe", "pedra", "praia", "ponta", "risco", "risos", "roupa",
        "rodar", "salto", "salve", "sonho", "suave", "tempo", "terra", "toque", "treno", "troca",
        "tarde", "tocar", "troco", "velha", "venha", "vezes", "verde", "vento", "vapor", "baile",
        "andar", "achar", "novas", "calma", "cerca", "manta", "renda"
      ],

      "normal": [
        "√°baco", "abade", "algor", "√¢mago", "√¢mbar", "andar", "√°pice", "arque", "baile",
        "bardo", "boato", "bolor", "calar", "carro", "casal", "certo", "chave", "c√≠vel", "cinto",
        "clima", "cofre", "coisa", "cores", "cruel", "dente", "d√©bil", "dique", "dizer", "doido",
        "dorso", "dueto", "√©gide", "√©brio", "enfim", "esgar", "ex√≠lio", "√™xito", "√™xodo", "f√°tuo",
        "feliz", "fenda", "ferro", "festa", "filho", "forja", "forno", "fruir", "fotos", "folha",
        "fruta", "f√∫ria", "gente", "g√™nio", "g√≠ria", "glifo", "glosa", "gosto", "grato", "h√≠men",
        "hoste", "√≠dolo", "id√≠lio", "√≠mpio", "√≠gneo", "√≠ndio", "√≠ntia", "irado", "jazem", "jejum",
        "jusso", "laudo", "leite", "letra", "lesma", "lim√£o", "limbo", "linha", "livro", "l√∫men",
        "macio", "manh√£", "manta", "matiz", "meiga", "meses", "metro", "meias", "m√≠dia", "misto",
        "moeda", "morar", "morro", "mundo", "nadar", "navio", "n√≠vel", "n√≠tido", "nobre", "noite",
        "norte", "nuvem", "ocaso", "√≥dio", "odiar", "olhos", "√≥rf√£o", "ousar", "pacto", "p√°lio",
        "papai", "p√°ria", "passe", "pasta", "peixe", "pedra", "piano", "piche", "p√≥len", "ponto",
        "praia", "pular", "quark", "relho", "renda", "reses", "r√©dea", "risco", "risos", "rodar",
        "rouca", "rufar", "salto", "salve", "sarca", "s√°tira", "seita", "s√≠mio", "sonho", "sorna",
        "s√≥sia", "s√∫cia", "s√∫dito", "suave", "sulco", "tarde", "t√©dio", "tenaz", "tempo", "t√™nue",
        "terra", "toque", "torvo", "tocar", "tra√ßo", "treno", "trupe", "troca", "troco", "tocar",
        "turvo", "√∫bere", "√∫mido", "vapor", "v√°rio", "velha", "venha", "veraz", "verde", "verbo",
        "vento", "vezes", "vinco", "vis√£o", "v√≠cio", "vulto", "z√™nite"
      ]
    };

    // Random word from the list
    const wordList = words.easy;

    // Random target word
    let targetWord = wordList[Math.floor(Math.random() * wordList.length)].toUpperCase(); 



    // Reference to board container
    const board = document.querySelector(".game-board");

    // Dynamically create rows and tiles for the game board
    for (let row = 0; row < NUM_ROWS; row++) {
      const rowElement = document.createElement("div");
      rowElement.classList.add("row");

      for (let col = 0; col < NUM_COLS; col++) {
        const tile = document.createElement("div");
        tile.classList.add("tile");
        tile.dataset.row = row;  // store row index
        tile.dataset.col = col;  // store column index
        rowElement.appendChild(tile);
      }

      board.appendChild(rowElement);
    }

    // Keyboard layout rows
    const keyboardLayout = [
      ["Q", "W", "E", "R", "T", "Y", "U", "I", "O", "P"],
      ["A", "S", "D", "F", "G", "H", "J", "K", "L"],
      ["‚Üµ", "Z", "X", "C", "V", "B", "N", "M", "üîô"]
    ];

    // Reference to virtual keyboard container
    const keyboard = document.querySelector(".virtual-keyboard");

    // Create buttons for each key in the layout
    keyboardLayout.forEach(row => {
      const rowDiv = document.createElement("div");
      rowDiv.classList.add("keyboard-row");

      row.forEach(key => {
        const keyButton = document.createElement("button");
        keyButton.textContent = key;
        keyButton.classList.add("key");
        // Larger keys for Enter (‚Üµ) and Backspace (üîô)
        if (key === "‚Üµ" || key === "üîô") {
          keyButton.classList.add("key-large");
        }
        keyButton.setAttribute("data-key", key);
        rowDiv.appendChild(keyButton);
      });

      keyboard.appendChild(rowDiv);
    });

    // Track current position on board
    let currentRow = 0;
    let currentCol = 0;

    // Store letters typed for current guess
    const currentGuess = [];

    // Allowed letters for input
    const LETTERS = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";

    // Listen for physical keyboard input
    document.addEventListener("keydown", (e) => {
      const key = e.key.toUpperCase();
      handleKey(key);
    });

    // Listen for clicks on virtual keyboard keys
    document.querySelector(".virtual-keyboard").addEventListener("click", (e) => {
      if (e.target.classList.contains("key")) {
        const key = e.target.textContent.toUpperCase();
        handleKey(key);
      }
    });

    // Handle key inputs from both physical and virtual keyboards
    function handleKey(key) {
      if (gameOver) return;

      if (key === "BACKSPACE" || key === "üîô") {
        deleteLetter();
      } else if (key === "ENTER" || key === "‚èé" || key === "‚Üµ") {
        submitGuess();
      } else if (LETTERS.includes(key) && currentCol < NUM_COLS) {
        insertLetter(key);
      }
    }


    // Insert letter into current tile and advance column
    function insertLetter(letter) {
      const tile = document.querySelector(
        `.tile[data-row="${currentRow}"][data-col="${currentCol}"]`
      );
      if (!tile) return;

      tile.textContent = letter;
      currentGuess.push(letter);
      currentCol++;
    }


    // Remove letter from current tile and move back column
    function deleteLetter() {
      if (currentCol === 0) return; // No letters to delete
      currentCol--;
      const tile = document.querySelector(
        `.tile[data-row="${currentRow}"][data-col="${currentCol}"]`
      );
      if (!tile) return;

      tile.textContent = "";
      currentGuess.pop();
    }


    // Open and close modal functions
    function openModal(contentHTML) {
      modalBody.innerHTML = contentHTML;
      modal.classList.remove('hidden');
    }

    function closeModal() {
      modal.classList.add('hidden');
      modalBody.innerHTML = '';
    }


    // Restart button after the end of the game
    function showRestartButton() {
      const btn = document.getElementById("restart-button");
      if (btn) btn.style.display = "block";
    }

    // Helper function to remove accentuation
    function removeAccent(str) {
      return str.normalize("NFD").replace(/[\u0300-\u036f]/g, "");
    }

    const letterUser = 'A'; // example, user typed A
    const letterTarget = '√É'; // example, original letter in the word

    // Consider the two letters equal
    if (removeAccent(letterUser.toUpperCase()) === removeAccent(letterTarget.toUpperCase())) {
    }


    // Submit the current guess for validation
    function submitGuess() {
      if (currentGuess.length !== NUM_COLS) return;

      const guess = currentGuess.join("");
      const tiles = document.querySelectorAll(`.tile[data-row="${currentRow}"]`);

      const targetLetters = targetWord.split("");
      const guessLetters = guess.split("");

      // First step: mark green letters (the correct ones)
      const result = Array(NUM_COLS).fill("absent"); // Can be: 'correct', 'present', 'absent'


      for (let i = 0; i < NUM_COLS; i++) {
        if (removeAccent(guessLetters[i].toUpperCase()) === removeAccent(targetLetters[i]?.toUpperCase())) {
          result[i] = "correct";
          targetLetters[i] = null; // Mark as used
        }
      }


      // Second step: mark yellow letters (letters in the secret word)
      for (let i = 0; i < NUM_COLS; i++) {
        if (result[i] === "correct") continue;
        
        const index = targetLetters.findIndex(
          (letter) => letter !== null &&
          removeAccent(letter.toUpperCase()) === removeAccent(guessLetters[i].toUpperCase())
        );

        if (index !== -1) {
          result[i] = "present";
          targetLetters[index] = null; // Mark as used
        }
      }


      // Apply CSS classes to the tiles
      for (let i = 0; i < NUM_COLS; i++) {
        const letter = guessLetters[i];
        const status = result[i];


        // Apply in the tile
        tiles[i].classList.add(status);

        if (status === "correct") {
          tiles[i].textContent = targetWord[i];
        }


        // Apply in the virtual keyboard
        const keyButton = document.querySelector(`.key[data-key="${letter}"]`);
        if (keyButton) {
          const oldClass = keyButton.dataset.status;

          // Priority: correct > present > absent
          const priority = { correct: 3, present: 2, absent: 1, undefined: 0 };
          if (priority[status] > priority[oldClass]) {
            keyButton.classList.remove("correct", "present", "absent");
            keyButton.classList.add(status);
            keyButton.dataset.status = status;
          }
        }
      }

        // Check win
        if (guess === removeAccent(targetWord)) {
          alert("You win!");
          gameOver = true;
          showRestartButton();
          return;
        }


      // Move to next row for next guess
      currentRow++;
      currentCol = 0;
      currentGuess.length = 0;

      if (currentRow >= NUM_ROWS) {
        alert(`Game over! The word was: ${targetWord}`);
        gameOver = true;
        showRestartButton();
      }
      
    }

    // DEBUG ONLY
    const footer = document.querySelector('footer');
    footer.innerHTML += targetWord;
  </script>
</body>
</html>
