<!-- Filename: index.html-->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Letra ‚Äî Jogo de palavras offline</title>
  <style>
    /* Light mode color variables */
    :root {
      /* Body will be dark as default */
      --color-bg: #121212;
      --color-text: #f1f1f1;
      --color-subtle: #aaaaaa;
      --color-border: #333333;
      --color-tile: #1e1e1e;

      --color-accent: #3ecf8e;       /* Accent color */
      --color-correct: #4caf50;      /* Correct letter tile color */
      --color-wrong-spot: #c9b458;   /* Letter in wrong position tile color */
      --color-incorrect: #b0b0b0;    /* Incorrect letter tile color */
    }

    /* Light theme configuration */
    body.light {
      --color-bg: #f9f9f9;           /* Main background */
      --color-text: #1a1a1a;         /* Default text color */
      --color-subtle: #6e6e6e;       /* Secondary text color */
      --color-border: #999999;       /* Borders and light lines */
      --color-tile: #e0e0e0;         /* Tile background (game squares) */
    }

    /* Reset default spacing and use border-box sizing */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    /* Base font size and smooth scrolling */
    html {
      font-size: 62.5%; /* 1rem = 10px */
      scroll-behavior: smooth;
    }

    /* Body layout and theming */
    body {
      display: flex;
      flex-direction: column;
      background-color: var(--color-bg);
      color: var(--color-text);
      font-family: sans-serif;
      font-size: 1.6rem; /* 16px */
      line-height: 1.5;
      transition: background-color 0.3s ease, color 0.3s ease;
      -webkit-font-smoothing: antialiased;
      min-height: 100vh;
      width: 100%;
    }

    /* Headings inherit font weight and color */
    h1, h2, h3, h4, h5, h6 {
      font-weight: 600;
      line-height: 1.2;
      color: inherit;
    }

    /* Links inherit color, no underline */
    a {
      color: inherit;
      text-decoration: none;
    }

    /* Remove default list styles */
    ul, ol {
      list-style: none;
    }

    /* Responsive media */
    img, picture, video, canvas, svg {
      max-width: 100%;
      display: block;
    }

    /* Form elements inherit font and remove borders */
    button, input, textarea, select {
      font: inherit;
      color: inherit;
      background: none;
      border: none;
      outline: none;
    }

    /* Remove number input spinner buttons on WebKit browsers */
    input[type="number"]::-webkit-inner-spin-button,
    input[type="number"]::-webkit-outer-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    /* --- Header --- */

    /* Header grid layout */
    header {
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      align-items: center;
      padding: 2rem 10rem;
    }
    
    /* Left button group */
    .left-buttons {
      justify-self: start;
      display: flex;
      gap: 1rem;
    }

    /* Right button group */
    .right-buttons {
      justify-self: end;
      display: flex;
      gap: 1rem;
    }

    /* Center app name styling */
    .app-name {
      font-size: clamp(1.4rem, 3vw, 2rem);
      justify-self: center;
      text-align: center;
    }

    /* Buttons in header larger for better tap targets */
    .left-buttons button,
    .right-buttons button {
      font-size: 3rem;
      border: solid 3px var(--color-text);
      border-radius: 1rem;
      padding: 0 1rem;
    }

    .left-buttons button:hover, 
    .right-buttons button:hover {
      cursor: pointer;
      transform: translateY(-5px);
      transition: 0.5s ease;
    }

    /* Configuration button dropdown menu */
    .config-dropdown {
      position: absolute;
      top: 8rem;
      right: 3rem;
      background-color: var(--color-tile);
      border: 2px solid var(--color-border);
      border-radius: 1rem;
      padding: 1rem;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
      z-index: 100;
      width: max-content;
    }

    .config-dropdown li {
      padding: 0.5rem 1rem;
      cursor: pointer;
      white-space: nowrap;
    }

    .config-dropdown li:hover {
      background-color: var(--color-accent);
      color: #fff;
      border-radius: 0.5rem;
      transition: 0.5s ease;
    }

    /* --- Modal ---*/

    /* Modal Window to show messages */
    .modal {
      position: fixed;
      width: 100vw;
      height: 100vh;
      background: rgba(0,0,0,0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 999;
    }

    /* The square that shows the modal content */
    .modal-content {
      display: flex;
      flex-direction: column;
      align-items: center;
      background: rgba(171, 161, 64, 0.8);
      color: #f1f1f1;
      font-size: 2rem;
      padding: 4rem 4rem;
      line-height: 3.5rem;
      border-radius: 8px;
      width: 70%;
      height: 70%;
      min-height: 400px;
      min-width: 400px;
      max-width: 900px;
      max-height: 900px;
      aspect-ratio: 1 / 1; /* Square form modal */
      overflow: auto;
    }

    /* Hidden content, until JavaScript turns it off */
    .hidden {
      display: none;
    }

    /* X button to close the modal. We can also close by clicking away from the modal content */
    .modal-content button {
      position: fixed;
      top: 8rem;
      left: 90%;
      font-size: 5rem;
      color: crimson;
      cursor: pointer;
      z-index: 100;
    }

    /* --- Restart button ---*/

    /* Appears after end game */
    .restart-button {
      display: flex;
      align-items: center;
      justify-content: center;
      margin: auto;
    }

    #restart-button {
      font-size: 5rem;
    }

    #restart-button:hover {
      cursor: pointer;
      transform: translateY(-10px);
      transition: 0.5s ease;
    }

    /* --- main, game board --- */

    /* Main board container styles */
    main {
      display: flex;
      align-items: center;
      justify-content: center;
      flex: 1; /* Take remaining vertical space */
    }
    
    /* Board holds rows vertically */
    .game-board {
      display: flex;
      flex-direction: column;
      max-width: 450px;
      width: min(70vw, 450px);
      gap: clamp(0.4rem, 1vw, 1rem);
      margin: auto;
    }

    /* Each row is a grid of 5 tiles */
    .row {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: clamp(0.4rem, 1vw, 1rem);
    }

    /* Individual tile style */
    .tile {
      aspect-ratio: 1 / 1; /* Make tile square */
      background-color: var(--color-tile);
      border: 2px solid var(--color-border);
      border-radius: 1rem;
      font-size: clamp(2rem, 6vw, 5rem);
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: center;
      text-transform: uppercase;
      user-select: none; /* Prevent text selection */
      transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease;
    }

    /* Tile color for correct letter and position */
    .tile.correct {
      background-color: var(--color-correct);
      border-color: var(--color-correct);
      color: white;
    }

    /* Tile color for correct letter wrong position */
    .tile.present {
      background-color: var(--color-wrong-spot);
      border-color: var(--color-wrong-spot);
      color: white;
    }

    /* Tile color for incorrect letter */
    .tile.absent {
      background-color: var(--color-incorrect);
      border-color: var(--color-incorrect);
      color: white;
    }
    
    /* --- Virtual Keyboard --- */

    /* Virtual keyboard container */
    .virtual-keyboard {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.5rem;
      padding: 2rem 1rem;
      width: min(95vw, 700px);
      max-width: 700px;
      margin: auto;
      box-sizing: border-box;
    }

    /* Each keyboard row */
    .keyboard-row {
      display: flex;
      justify-content: center;
      gap: 0.4rem;
      width: 100%;
    }

    /* Individual key style */
    .key {
      background-color: var(--color-tile);
      color: var(--color-text);
      font-size: clamp(1rem, 3vw, 2.5rem); /* Responsive font size */
      font-weight: bold;
      padding: 0.6em 0.4em;
      border: none;
      border-radius: 0.6rem;
      cursor: pointer;
      text-transform: uppercase;
      flex: 1;
      min-width: 1.5rem;
      transition: background-color 0.2s ease;
      box-sizing: border-box;
    }

    /* Hover effect for keys */
    .key:hover {
      background-color: var(--color-border);
    }

    /* Larger keys for Enter and Backspace */
    .key-large {
      flex: 1.5;
    }

    /* Color to the keys */
    .key.correct {
      background-color: #538d4e;
      color: white;
    }

    .key.present {
      background-color: #b59f3b;
      color: white;
    }

    .key.absent {
      background-color: #3a3a3c;
      color: white;
    }

    /* --- Footer --- */
    footer {
      text-align: center;
      padding: 1.5rem;
      background-color: var(--color-tile);
    }

    footer a {
      color: var(--color-accent);
      cursor: pointer;
    }

    /* --- Media (responsiveness) --- */

    /* Responsiveness to mobile devices */
    @media (max-width: 600px) {
      body {
        min-height: 100dvh;
      }

      .game-board {
        width: clamp(250px, 80vw, 450px);
      }

      .restart-button {
        margin-top: clamp(1rem, 4vw, 2rem);
      }

      #restart-button {
        font-size: clamp(2.5rem, 7vw, 3.5rem);
      }

      footer {
        padding: clamp(0.5rem, 2vw, 1rem);
      }

      header {
        padding: clamp(1.5rem, 4vw, 2rem) clamp(1.5rem, 5vw, 3rem);
      }

      .left-buttons button,
      .right-buttons button {
        font-size: clamp(1.4rem, 5vw, 2rem);
        border: solid 2px #ccc;
      }

      .app-name {
        font-size: clamp(1.2rem, 4vw, 1.4rem);
      }

      .modal-content {
        font-size: clamp(1.6rem, 4vw, 2rem);
        min-height: 400px;
        min-width: 300px;
        max-width: 350px;
        max-height: 600px;
      }

      .modal-content button {
        font-size: clamp(2.5rem, 6vw, 3.5rem);
      }
    }

    /* Applied when the device is horizontal */
    @media (max-width: 916px) and (max-height: 500px) and (orientation: landscape) {
      .tile {
        font-size: clamp(1.2rem, 3vw, 1.6rem);
      }

      .game-board {
        width: clamp(180px, 25vw, 300px);
        margin-top: 0;
      }

      header {
        padding: clamp(1rem, 4vw, 2rem) auto;
      }

      header .app-name {
        font-size: clamp(1.2rem, 4vw, 1.6rem);
      }

      .left-buttons button,
      .right-buttons button {
        font-size: clamp(1.4rem, 5vw, 2rem);
        border: solid 2px #ccc;
      }

      #restart-button {
        font-size: clamp(2rem, 6vw, 3rem);
      }

      .virtual-keyboard {
        width: clamp(200px, 70vw, 600px);
        margin: clamp(0.5rem, 2vw, 1rem) auto;
      }

      .modal-content {
        font-size: clamp(1.2rem, 3.5vw, 1.6rem);
        max-width: 350px;
        max-height: 500px;
      }

      .modal-content button {
        top: clamp(2rem, 5vw, 4.5rem);
        left: 90%;
        font-size: clamp(2.5rem, 5vw, 3.5rem);
      }
    }
  </style>
</head>

<body>
  <!-- Website Header -->
  <header>
    <div class="left-buttons">
      <button type="button" id="help" aria-label="Help">‚ùî</button>
      <button type="button" id="stats" aria-label="Stats">üìä</button>
    </div>
    
    <div class="app-name">
      <h1>LETRA</h1>
    </div>

    <div class="right-buttons">
      <!-- Toggle between light and dark mode -->
      <button type="button" id="theme" aria-label="Toggle between dark and light mode">üí°</button>
      <!-- Configuration button with dropdown menu list -->
      <button type="button" id="cfg" aria-label="Configurations">‚öôÔ∏è</button>
      <div class="config-dropdown hidden" id="config-dropdown">
        <ul>
          <li data-action="clearStats">Resetar estat√≠sticas</li>
          <li data-action="showAbout">Sobre o projeto</li>
          <li data-action="showTipsModal">Dicas para vencer</li>
        </ul>
      </div>
    </div>
  </header>

  <!-- Modal container -->
  <div id="modal" class="modal hidden">
    <div class="modal-content" id="modal-content">
      <button onclick="closeModal()">üóô</button>
      <div id="modal-body">
        <!-- Dinamic content will be inserted here -->
      </div>
    </div>
  </div>


  <div class="restart-button">
    <button id="restart-button" style="display: none;" onclick="location.reload()">üîÑ</button>
  </div>


  <!-- Main board area with rows for each guess attempt -->
  <main>

    <div class="game-board">
      <!-- Tiles will be generated here dynamically with js -->
    </div>
  </main>
 

  <!-- On-screen keyboard for input, will be generated here with js-->
  <div class="virtual-keyboard data-status"></div>


  <footer>
    <small>Personal learning project, inspired by the term.ooo game ‚Äî Developed by <a href="https://www.github.com/xyz-leo" target="_blank">xyz-leo</a></small>
  </footer>

  <script>
    // Constants for board size
    const NUM_ROWS = 6;
    const NUM_COLS = 5;
    
    // Track if the game have been ended
    let gameOver = false;

    // Modal
    const modal = document.getElementById('modal');
    const modalContent = document.getElementById('modal-content');
    const modalBody = document.getElementById('modal-body');

    modal.addEventListener('click', (event) => {
      // Se o clique foi diretamente no fundo (modal), e n√£o dentro da caixinha (modal-content)
      if (event.target === modal) {
        closeModal();
      }
    });

    // --- Header buttons ---

    // Help button
    const helpbtn = document.getElementById('help');

    helpbtn.addEventListener('click', () => {
      openModal(`<h2>Como Jogar LETRA</h2>
<p>Bem-vindo ao LETRA ‚Äî um jogo de adivinha√ß√£o de palavras offline inspirado no Term.ooo!</p>

<h3>Objetivo</h3>
<p>Adivinhe a palavra secreta em at√© 6 tentativas.</p>

<h3>Como Jogar</h3>
<ul>
  <li>Digite uma palavra de 5 letras usando o teclado virtual ou o teclado f√≠sico.</li>
  <li>Ap√≥s cada tentativa, as cores das letras ir√£o mudar para indicar:</li>
  <ul>
    <li><strong>Verde:</strong> letra correta e na posi√ß√£o certa.</li>
    <li><strong>Amarelo:</strong> letra correta, mas na posi√ß√£o errada.</li>
    <li><strong>Cinza:</strong> letra incorreta, n√£o est√° na palavra.</li>
  </ul>
  <li>Use essas dicas para ajustar suas pr√≥ximas tentativas.</li>
</ul>

<h3>Bot√µes</h3>
<ul>
  <li><strong>‚ùî Help:</strong> abre este tutorial.</li>
  <li><strong>üìä Stats:</strong> mostra suas estat√≠sticas de jogo.</li>
  <li><strong>üí° Tema:</strong> alterna entre modo claro e escuro.</li>
  <li><strong>‚öôÔ∏è Configura√ß√µes:</strong> ajustes do jogo.</li>
  <li><strong>üîÑ Reiniciar:</strong> reinicia o jogo atual.</li>
</ul>

<p>Divirta-se e boa sorte!</p>
`);
    })


    // Stats button
    const statsbtn = document.getElementById('stats');

    statsbtn.addEventListener('click', () => {
      openModal(`
<h2>Estat√≠sticas</h2><br>
<h3>Partidas jogadas: ${getGamesPlayed()}</h3><br>
<h3>Partidas vencidas: ${getCorrectWordsCount()}</h3><br>
<h3>Partidas perdidas: ${getLostGamesCount()}</h3><br>
<h3>Tentativas: ${getAttemptsCount()}</h3><br>
<h3>Taxa de vit√≥rias: ${getWinRate().toFixed(2)}%</h3><br>
<h3>M√©dia de tentativas para vencer: ${getAvgAttemptsToWin().toFixed(2)}</h3>
`);
    })


    // Theme dark/light mode change
    const togglebtn = document.getElementById('theme');
    const body = document.body;

    // Apply the saved theme on page loading
    function applyTheme() {
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme === 'dark') {
        body.classList.add('dark');
        body.classList.remove('light');
      } else if (savedTheme === 'light') {
        body.classList.add('light');
        body.classList.remove('dark');
      } else {
        // If nothing is saved, set dark as default
        body.classList.add('dark');
        body.classList.remove('light');
      }
    }

    applyTheme();

    togglebtn.addEventListener('click', () => {
      if (body.classList.contains('dark')) {
        body.classList.remove('dark');
        body.classList.add('light');
        localStorage.setItem('theme', 'light');
      } else {
        body.classList.remove('light');
        body.classList.add('dark');
        localStorage.setItem('theme', 'dark');
      }
    });
    

    // Configuration button
    const cfgbtn = document.getElementById('cfg');
    const cfgDropdown = document.getElementById('config-dropdown');
      
    cfgbtn.addEventListener('click', () => {
      cfgDropdown.classList.toggle('hidden');
    });

    document.addEventListener('click', (e) => {
      if (!cfgbtn.contains(e.target) && !cfgDropdown.contains(e.target)) {
        cfgDropdown.classList.add('hidden');
      }
    });

    // Event delegation to the dropdown menu list items
    cfgDropdown.addEventListener('click', (e) => {
      const action = e.target.dataset.action;

      switch (action) {
        case 'clearStats':
          clearStats();
          break;
        case 'showAbout':
          openModal(`
<h2>LETRA</h2>
<p><strong>LETRA</strong> √© um jogo minimalista de adivinha√ß√£o de palavras de 5 letras, inspirado no site <a href="https://term.ooo/" target=_blank style="color: #3ecf8e;">term.ooo</a>. O jogador tem seis tentativas para descobrir a palavra secreta.</p><br>
<h2>Detalhes t√©cnicos</h2>
<p>A interface foi constru√≠da com <code>HTML</code>, <code>CSS</code> e <code>JavaScript</code> puros, sem uso de bibliotecas ou framework externos. Todo o projeto est√° contido em um √∫nico arquivo <code>.html</code>, o que permite que ele funcione completamente offline, sem necessidade de servidor ou instala√ß√£o. Essa abordagem refor√ßa a proposta de simplicidade e portabilidade.</p><br>
<h2>Meu objetivo</h2>
<p>O principal objetivo deste projeto foi criar algo divertido que tamb√©m servisse como exerc√≠cio pr√°tico para refinar minhas habilidades em programa√ß√£o front-end.</p><br>
<h2>Meu GitHub</h2>
<a href="https://github.com/xyz-leo" target=_blank style="color: #3ecf8e;">xyz-leo</a>
`);
          break;
        case 'showTipsModal':
          openModal(`
<h2>Dicas para Vencer</h2>
<p>Algumas estrat√©gias podem aumentar muito suas chances de acertar a palavra oculta em menos tentativas:</p>

<ul>
  <li><strong>1. Comece com uma palavra forte:</strong> Use palavras iniciais que contenham letras comuns da l√≠ngua portuguesa, como todas as vogais e consoantes <em style="color: #3ecf8e;">A, E, I, O, U, R, S, T, L...</em>. Exemplos: <code style="color: #3ecf8e;">IDEAL</code>, <code style="color: #3ecf8e">ACIDO</code>, <code style="color: #3ecf8e;">AUREO</code>.</li>

  <li><strong>2. Evite repetir letras no come√ßo:</strong> Tente usar 5 letras diferentes nas primeiras tentativas. Isso te ajuda a revelar mais op√ß√µes e eliminar letras rapidamente.</li>

  <li><strong>3. Elimine letras com l√≥gica:</strong> Se uma letra j√° apareceu como <span style="color:#444;">cinza</span> em v√°rias posi√ß√µes, evite us√°-la novamente.</li>

  <li><strong>4. Use palavras de teste:</strong> Se estiver em d√∫vida, insira uma palavra apenas para testar letras novas, mesmo que ache que n√£o √© a resposta final.</li>

  <li><strong>5. Jogue com calma:</strong> Pense antes de tentar. Use as pistas anteriores para guiar cada nova palavra. A pressa leva a erros!</li>
  
  <li><strong>6. Evite palavras inventadas:</strong> Para manter o jogo divertido e o desafio justo, evite digitar palavras aleat√≥rias ou inexistentes apenas para testar letras, j√° que este jogo n√£o faz a verifica√ß√£o no dicion√°rio.</li>
</ul>
`)
          break;
      }
    });


    // words
    const words = {
      "easy": [
        "amigo", "andar", "baile", "banco", "bicho", "botas", "brisa", "cabra",
        "carta", "casal", "caixa", "carro", "certo", "chave", "cinza", "claro", "clima", "cofre",
        "coisa", "cores", "cesta", "cinto", "campo", "dente", "dizer", "doido", "d√≥lar", "feira",
        "feliz", "ferro", "festa", "filho", "fotos", "folha", "forno", "fruta", "gente", "gosto",
        "janela", "jogar", "leite", "letra", "lim√£o", "limpo", "linha", "livro", "lugar", "limpo",
        "mam√£e", "macio", "meias", "meiga", "metro", "moeda", "morar", "mundo", "navio",
        "noite", "norte", "nobre", "nuvem", "nadar", "olhos", "papai", "pacto", "pasta", "piano",
        "ponto", "pular", "passe", "peixe", "pedra", "praia", "ponta", "risco", "risos", "roupa",
        "rodar", "salto", "salve", "sonho", "suave", "tempo", "terra", "toque", "treno", "troca",
        "tarde", "tocar", "troco", "velha", "venha", "vezes", "verde", "vento", "vapor", "baile",
        "andar", "achar", "novas", "calma", "cerca", "manta", "renda"
      ],

      "normal": [
        "√°baco", "abade", "algor", "√¢mago", "√¢mbar", "andar", "√°pice", "arque", "baile",
        "bardo", "boato", "bolor", "calar", "carro", "casal", "certo", "chave", "c√≠vel", "cinto",
        "clima", "cofre", "coisa", "cores", "cruel", "dente", "d√©bil", "dique", "dizer", "doido",
        "dorso", "dueto", "√©gide", "√©brio", "enfim", "esgar", "ex√≠lio", "√™xito", "√™xodo", "f√°tuo",
        "feliz", "fenda", "ferro", "festa", "filho", "forja", "forno", "fruir", "fotos", "folha",
        "fruta", "f√∫ria", "gente", "g√™nio", "g√≠ria", "glifo", "glosa", "gosto", "grato", "h√≠men",
        "hoste", "√≠dolo", "id√≠lio", "√≠mpio", "√≠gneo", "√≠ndio", "√≠ntia", "irado", "jazem", "jejum",
        "jusso", "laudo", "leite", "letra", "lesma", "lim√£o", "limbo", "linha", "livro", "l√∫men",
        "macio", "manh√£", "manta", "matiz", "meiga", "meses", "metro", "meias", "m√≠dia", "misto",
        "moeda", "morar", "morro", "mundo", "nadar", "navio", "n√≠vel", "n√≠tido", "nobre", "noite",
        "norte", "nuvem", "ocaso", "√≥dio", "odiar", "olhos", "√≥rf√£o", "ousar", "pacto", "p√°lio",
        "papai", "p√°ria", "passe", "pasta", "peixe", "pedra", "piano", "piche", "p√≥len", "ponto",
        "praia", "pular", "quark", "relho", "renda", "reses", "r√©dea", "risco", "risos", "rodar",
        "rouca", "rufar", "salto", "salve", "sarca", "s√°tira", "seita", "s√≠mio", "sonho", "sorna",
        "s√≥sia", "s√∫cia", "s√∫dito", "suave", "sulco", "tarde", "t√©dio", "tenaz", "tempo", "t√™nue",
        "terra", "toque", "torvo", "tocar", "tra√ßo", "treno", "trupe", "troca", "troco", "tocar",
        "turvo", "√∫bere", "√∫mido", "vapor", "v√°rio", "velha", "venha", "veraz", "verde", "verbo",
        "vento", "vezes", "vinco", "vis√£o", "v√≠cio", "vulto", "z√™nite"
      ]
    };


    // Random word from the list
    const wordList = words.easy;

    // Random target word (secret word of the match)
    let targetWord = wordList[Math.floor(Math.random() * wordList.length)].toUpperCase(); 


    // Reference to board container
    const board = document.querySelector(".game-board");

    // Dynamically create rows and tiles for the game board
    for (let row = 0; row < NUM_ROWS; row++) {
      const rowElement = document.createElement("div");
      rowElement.classList.add("row");

      for (let col = 0; col < NUM_COLS; col++) {
        const tile = document.createElement("div");
        tile.classList.add("tile");
        tile.dataset.row = row;  // store row index
        tile.dataset.col = col;  // store column index
        rowElement.appendChild(tile);
      }

      board.appendChild(rowElement);
    }

    // Keyboard layout rows
    const keyboardLayout = [
      ["Q", "W", "E", "R", "T", "Y", "U", "I", "O", "P"],
      ["A", "S", "D", "F", "G", "H", "J", "K", "L"],
      ["‚Üµ", "Z", "X", "C", "V", "B", "N", "M", "üîô"]
    ];

    // Reference to virtual keyboard container
    const keyboard = document.querySelector(".virtual-keyboard");

    // Create buttons for each key in the layout
    keyboardLayout.forEach(row => {
      const rowDiv = document.createElement("div");
      rowDiv.classList.add("keyboard-row");

      row.forEach(key => {
        const keyButton = document.createElement("button");
        keyButton.textContent = key;
        keyButton.classList.add("key");
        // Larger keys for Enter (‚Üµ) and Backspace (üîô)
        if (key === "‚Üµ" || key === "üîô") {
          keyButton.classList.add("key-large");
        }
        keyButton.setAttribute("data-key", key);
        rowDiv.appendChild(keyButton);
      });

      keyboard.appendChild(rowDiv);
    });


    // Track current position on board
    let currentRow = 0;
    let currentCol = 0;

    // Store letters typed for current guess
    const currentGuess = [];

    // Allowed letters for input
    const LETTERS = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";

    // Listen for physical keyboard input
    document.addEventListener("keydown", (e) => {
      const key = e.key.toUpperCase();
      handleKey(key);
    });

    // Listen for clicks on virtual keyboard keys
    document.querySelector(".virtual-keyboard").addEventListener("click", (e) => {
      if (e.target.classList.contains("key")) {
        const key = e.target.textContent.toUpperCase();
        handleKey(key);
      }
    });

    // Handle key inputs from both physical and virtual keyboards
    function handleKey(key) {
      if (gameOver) return;

      if (key === "BACKSPACE" || key === "üîô") {
        deleteLetter();
      } else if (key === "ENTER" || key === "‚èé" || key === "‚Üµ") {
        submitGuess();
      } else if (LETTERS.includes(key) && currentCol < NUM_COLS) {
        insertLetter(key);
      }
    }


    // Insert letter into current tile and advance column
    function insertLetter(letter) {
      const tile = document.querySelector(
        `.tile[data-row="${currentRow}"][data-col="${currentCol}"]`
      );
      if (!tile) return;

      tile.textContent = letter;
      currentGuess.push(letter);
      currentCol++;
    }


    // Remove letter from current tile and move back column
    function deleteLetter() {
      if (currentCol === 0) return; // No letters to delete
      currentCol--;
      const tile = document.querySelector(
        `.tile[data-row="${currentRow}"][data-col="${currentCol}"]`
      );
      if (!tile) return;

      tile.textContent = "";
      currentGuess.pop();
    }


    // --- Modal ---
    function openModal(contentHTML) {
      modalBody.innerHTML = contentHTML;
      modal.classList.remove('hidden');
    }

    function closeModal() {
      modal.classList.add('hidden');
      modalBody.innerHTML = '';
    }


    // --- Restart button after the end of the game ---
    function showRestartButton() {
      const btn = document.getElementById("restart-button");
      if (btn) btn.style.display = "block";
    }

    // --- Helper function to remove accentuation ---
    function removeAccent(str) {
      return str.normalize("NFD").replace(/[\u0300-\u036f]/g, "");
    }

    const letterUser = 'A'; // example, user typed A
    const letterTarget = '√É'; // example, original letter in the word

    // Consider the two letters equal
    if (removeAccent(letterUser.toUpperCase()) === removeAccent(letterTarget.toUpperCase())) {
    }


    // --- Submit the current guess for validation ---
    function submitGuess() {
      if (currentGuess.length !== NUM_COLS) return;

      const guess = currentGuess.join("");
      const tiles = document.querySelectorAll(`.tile[data-row="${currentRow}"]`);

      const targetLetters = targetWord.split("");
      const guessLetters = guess.split("");

      // First step: mark green letters (the correct ones)
      const result = Array(NUM_COLS).fill("absent"); // Can be: 'correct', 'present', 'absent'


      for (let i = 0; i < NUM_COLS; i++) {
        if (removeAccent(guessLetters[i].toUpperCase()) === removeAccent(targetLetters[i]?.toUpperCase())) {
          result[i] = "correct";
          targetLetters[i] = null; // Mark as used
        }
      }


      // Second step: mark yellow letters (letters in the secret word)
      for (let i = 0; i < NUM_COLS; i++) {
        if (result[i] === "correct") continue;
        
        const index = targetLetters.findIndex(
          (letter) => letter !== null &&
          removeAccent(letter.toUpperCase()) === removeAccent(guessLetters[i].toUpperCase())
        );

        if (index !== -1) {
          result[i] = "present";
          targetLetters[index] = null; // Mark as used
        }
      }


      // Apply CSS classes to the tiles
      for (let i = 0; i < NUM_COLS; i++) {
        const letter = guessLetters[i];
        const status = result[i];


        // Apply in the tile
        tiles[i].classList.add(status);

        if (status === "correct") {
          tiles[i].textContent = targetWord[i];
        }


        // Apply in the virtual keyboard
        const keyButton = document.querySelector(`.key[data-key="${letter}"]`);
        if (keyButton) {
          const oldClass = keyButton.dataset.status;

          // Priority: correct > present > absent
          const priority = { correct: 3, present: 2, absent: 1, undefined: 0 };
          if (priority[status] > priority[oldClass]) {
            keyButton.classList.remove("correct", "present", "absent");
            keyButton.classList.add(status);
            keyButton.dataset.status = status;
          }
        }
      }
          
        // Will increment games played on the first attempt
        if (currentRow === 0) {
          incrementGamesPlayed();
        }

        // Every attempt will be registered
        incrementAttemptsCount();

        // Check win
        if (guess === removeAccent(targetWord)) {
          alert("You win!");
          incrementCorrectWords(currentRow + 1);
          gameOver = true;
          showRestartButton();
          return;
        }

      // Move to next row for next guess
      currentRow++;
      currentCol = 0;
      currentGuess.length = 0;

      if (currentRow >= NUM_ROWS) {
        alert(`Game over! A palavra era: ${targetWord}`);
        gameOver = true;
        incrementLostGames();
        showRestartButton();
      }
    }


    // --- STATS ---

    // Function to get the current statistics
    function getStats() {
      // Get the stats from the localstorage
      const statsStr = localStorage.getItem('gameStats');

      // If it does not exists, return 0
      if (!statsStr) {
        return {
          correctWords: 0,
          attemptsCount: 0,
          lostGames: 0,
          gamesPlayed: 0,
          totalAttemptsToWin: 0,
        };
      }
      return JSON.parse(statsStr);
    }

    function saveStats(stats) {
      localStorage.setItem('gameStats', JSON.stringify(stats));
    }


    // Total games winned by the player
    function getCorrectWordsCount() {
      return getStats().correctWords;
    }

    // Function to increment the counter if the player won
    function incrementCorrectWords(attemptsUsed) {
      const stats = getStats();
      stats.correctWords++;
      stats.totalAttemptsToWin = (stats.totalAttemptsToWin || 0) + attemptsUsed;
      saveStats(stats);
    }


    // Total attempts
    function getAttemptsCount() {
      return getStats().attemptsCount;
    }

    function incrementAttemptsCount() {
      const stats = getStats();
      stats.attemptsCount++;
      saveStats(stats);
    }


    // Total games played
    function getGamesPlayed() {
      return getStats().gamesPlayed;
    }

    function incrementGamesPlayed() {
      const stats = getStats();
      stats.gamesPlayed++;
      saveStats(stats);
    }


    // Lost games (game over)
    // Could be gamesPlayed - correctWords
    function getLostGamesCount() {
      return getStats().lostGames;
    }

    function incrementLostGames() {
      const stats = getStats();
      stats.lostGames++;
      saveStats(stats);
    }

    function incrementTotalAttemptsToWin(attemptsUsed) {
      const stats = getStats();
      stats.totalAttemptsToWin += attemptsUsed;
      saveStats(stats);
    }

    // Win rate - read only - separation of concerns
    function getWinRate() {
      const stats = getStats();
      if (stats.gamesPlayed === 0) return 0;
      return (stats.correctWords / stats.gamesPlayed) * 100;
    }

    // Average attempts to win - totalAttemptsToWin / correctWords
    function getAvgAttemptsToWin() {
      const stats = getStats();
      if (!stats.correctWords || stats.correctWords === 0) return 0;
      return stats.totalAttemptsToWin / stats.correctWords;
    }


    // Clear stats (option in the configuration button dropdown menu)
    function clearStats() {
      localStorage.removeItem('gameStats');
      location.reload();
    }

    // DEBUG ONLY
    const footer = document.querySelector('footer');
    footer.innerHTML += targetWord;
  </script>
</body>
</html>
